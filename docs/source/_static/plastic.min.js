/*! plastic - v0.0.4 - 2014-05-09
* https://github.com/Fannon/plasticjs
* Copyright (c) 2014 Simon Heimler; Licensed MIT */
var plastic={version:"0.0.5",elements:[],modules:{query:{},api:{},data:{},display:{}},helper:{}};plastic.execute=function(){"use strict";this.options.debug&&plastic.msg.log("[MAIN] plastic.js version v"+plastic.version+" INIT"),plastic.events=new plastic.helper.Events;var a=$("plastic, .plastic-js");a.each(function(){var a=$(this);if(plastic.options.debug)plastic.elements.push(new plastic.Element(a));else if(plastic.options.debug)plastic.elements.push(new plastic.Element(a));else try{plastic.elements.push(new plastic.Element(a))}catch(b){plastic.msg.error("plastic element crashed while init","error",a)}}),plastic.modules.dependencyManager.fetch(),$.each(plastic.elements,function(a,b){if(b.options.debug)b.execute();else try{b.execute()}catch(c){plastic.message.error("plastic.js Element Crash on init")}})},$(document).ready(function(){plastic.execute()}),plastic.options={debug:!0,log:!0,benchmark:!1,width:"100%",height:"auto",timeout:3e3},plastic.Element=function(a){var b=this;this.$el=a,this.id=void 0,this.id=a&&a[0]&&a[0].id?a[0].id:"plastic-el-"+plastic.elements.length+1,this.options=plastic.options,this.options.debug&&plastic.msg.log("[#"+this.id+"] new plastic.Element()"),this.events=new plastic.helper.Events,this.eventsTotal=1,this.eventsProgress=0,this.benchmarkStart=(new Date).getTime(),this.benchmarkDataLoaded=0,this.benchmarkModulesLoaded=[],this.benchmarkCompleted=0,this.dependencies=[],this.attr=new plastic.ElementAttributes(this),this.queryModule=!1,this.dataModule=!1,this.displayModule=!1,this.mergeOptions(),this.registerDependencies();for(var c=function(){"use strict";b.benchmarkModulesLoaded.push((new Date).getTime()),this.updateProgress()},d=0;d<this.dependencies.length;d++)this.eventsTotal+=1,plastic.events.sub("loaded-"+this.dependencies[d],b,c)},plastic.Element.prototype={execute:function(){var a=this;if(this.createMessageContainer(this.$el),this.createDisplayContainer(this.$el),this.attr.query&&(this.queryModule=new plastic.modules.Module(this,"query",this.attr.query.module)),this.attr.data&&this.attr.data.url){this.options.debug&&plastic.msg.log("[#"+this.id+"] Data-URL: "+this.attr.data.url);try{$.ajax({url:this.attr.data.url,dataType:"json",timeout:this.options.timeout,success:function(b){"use strict";a.attr.data.raw=null!==b&&"object"==typeof b?b:$.parseJSON(b),a.benchmarkDataLoaded=(new Date).getTime(),a.attr.raw=b,a.updateProgress(),a.events.pub("data-sucess")},error:function(){plastic.msg('Could not get Data from URL <a href="'+a.attr.data.url+'">'+a.attr.data.url+"</a>","error",a.$el),a.cancelProgress()}})}catch(b){throw plastic.msg.error(b),new Error("Data Request failed")}}else a.updateProgress()},updateAttributes:function(){"use strict";this.attributes=new plastic.ElementAttributes(this.$el)},createMessageContainer:function(){"use strict";this.$el.css("position","relative"),this.$el.append('<div class="plastic-js-messages"></div>');var a=this.$el.find(".plastic-js-messages");a.width(this.$el.width())},createDisplayContainer:function(){"use strict";this.$el.append('<div class="plastic-js-display"></div>');var a=this.$el.find(".plastic-js-display");a.height(this.$el.height()).width(this.$el.width())},updateProgress:function(){"use strict";this.eventsProgress+=1,this.options.debug&&plastic.msg.log("[#"+this.id+"] Current Progress: "+this.eventsProgress+"/"+this.eventsTotal),this.eventsProgress===this.eventsTotal&&this.completeProgress()},cancelProgress:function(){"use strict";plastic.msg("plastic.js processing aborted.","error",this.$el),this.events=new plastic.helper.Events},completeProgress:function(){"use strict";this.dataModule=new plastic.modules.Module(this,"data",this.attr.data.module),this.applySchema(),this.displayModule=new plastic.modules.Module(this,"display",this.attr.display.module),this.benchmarkCompleted=(new Date).getTime(),this.options.benchmark&&this.displayBenchmark()},registerDependencies:function(){"use strict";var a=plastic.modules.moduleManager.get("display",this.attr.display.module);if(plastic.modules.dependencyManager.add(a.dependencies),this.attr.data&&this.attr.data.module){var b=plastic.modules.moduleManager.get("data",this.attr.data.module);plastic.modules.dependencyManager.add(b.dependencies)}this.dependencies=this.dependencies.concat(a.dependencies)},mergeOptions:function(){"use strict";this.options=$.extend(!0,{},plastic.options,this.attr.options.general)},displayBenchmark:function(){"use strict";var a=this.benchmarkDataLoaded-this.benchmarkStart,b=this.benchmarkCompleted-this.benchmarkStart,c="[#"+this.id+"] BENCHMARK:";c+=" DATA: "+a+"ms";for(var d=0;d<this.benchmarkModulesLoaded.length;d++){var e=this.benchmarkModulesLoaded[d],f=e-this.benchmarkStart;c+=" | MODULE-"+(d+1)+": "+f+"ms"}c+=" | TOTAL: "+b+"ms",plastic.msg.log(c)},applySchema:function(){"use strict";var a=this,b=this.attr.data.processed,c=this.attr.data.description,d=function(){for(var d={email:function(a){var b=a.replace("mailto:","");return'<a href="'+a+'">'+b+"</a>"},phone:function(a){var b=a.replace("tel:","");return'<a href="'+a+'">'+b+"</a>"},uri:function(a){var b=a.replace(/\w*:\/{2}/g,"");return'<a href="'+a+'">'+b+"</a>"}},e=$.extend(!0,[],b),f=0;f<e.length;f++){var g=e[f];for(var h in g)for(var i=g[h],j=c[h].format,k=0;k<i.length;k++)j&&(i[k]=d[j](i[k]))}a.attr.data.processedHtml=e};c&&Object.keys(c).length>0&&d()}},plastic.ElementAttributes=function(a){this.pEl=a,this.$el=a.$el,this.style=!1,this.options=!1,this.query=!1,this.data=!1,this.parse(),this.validate()},plastic.ElementAttributes.prototype={attrObjSchema:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{style:{type:"object",properties:{width:{type:"number"},height:{type:"number"}}},options:{type:"object",properties:{general:{type:"object"},display:{type:"object",properties:{module:{type:"string"},options:{type:"object"}},required:["module","options"]}},required:["general","display"]},query:{type:["object","boolean"],properties:{text:{type:"string"},module:{type:"string"},url:{type:"string"}},required:["module","text","url"]},data:{type:["object","boolean"],properties:{module:{type:"string"},raw:{type:["object","array","string"]},processed:{type:"array"},processedHtml:{type:"array"},url:{type:"string"},description:{type:"object"}},required:["module"]}},required:["style","options"]},getAttrObj:function(){"use strict";var a={style:this.style,options:this.options,display:this.display};return this.data&&(a.data=this.data),this.query&&(a.query=this.query),a},parse:function(){"use strict";this.getStyle(),this.getOptions(),this.getQuery(),this.getData(),this.getDataDescription(),this.pEl.options.debug&&plastic.msg.dir(this.getAttrObj())},getStyle:function(){"use strict";this.style={},this.style.height=this.$el.height(),this.style.width=this.$el.width()},getOptions:function(){"use strict";var a={},b=this.$el.find(".plastic-options");if(!(b.length>0))throw plastic.msg("No options provided!","error",this.$el),new Error("No options provided!");var c=b[0].text;if(!c||""===c)throw plastic.msg("Empty Obptions Element!","error",this.$el),new Error("Empty Obptions Element!");try{a=$.parseJSON(c),this.options=a,this.display=a.display}catch(d){throw console.dir(d),plastic.msg("Invalid JSON in the Options Object!"),new Error(d)}},getQuery:function(){"use strict";var a=this.$el.find(".plastic-query");if(a.length>0){var b={};b.url=a.attr("data-query-url"),b.module=a.attr("type");var c=a[0].text;if(!c||""===c)throw plastic.msg("Empty Query Element!","error",this.$el),new Error("Empty Query Element!");b.text=c,this.query=b}},getDataDescription:function(){"use strict";var a=this.$el.find(".plastic-schema");if(a.length>0){var b=a[0].text;b&&""!==b?this.data.description=$.parseJSON(b):plastic.msg("Data Description Element provided, but empty!","error",this.$el)}},getData:function(){"use strict";var a={},b=this.$el.find(".plastic-data");if(b.length>0){if(a.url=b.attr("data-url"),a.module=b.attr("data-format"),!a.url){var c=b[0].text;c&&""!==c?a.raw=$.parseJSON(c):plastic.msg("Empty Data Element!","error",this.$el)}this.data=a}},validate:function(){"use strict";var a=jjv();a.addSchema("schema",this.attrObjSchema);var b=a.validate("schema",this.getAttrObj());if(b)throw console.dir(b),new Error("Data Structure invalid!")}},plastic.msg={_logs:[],log:function(a,b){"use strict";this.createLogEntry(a,"info",b),console.log(a)},dir:function(a){"use strict";this.createLogEntry(a,"dump"),console.dir(a)},warn:function(a,b){"use strict";this.createLogEntry(a,"warning",b),console.warn(a)},error:function(a,b){console.error(a),this.createLogEntry(a,"error",b),this.createNotification(a,"error",b)},createLogEntry:function(a,b,c){"use strict";if(plastic.options.log){var d={timestamp:(new Date).getTime(),type:b,msg:a};c&&(d.el=c),this._logs.push(d)}},createNotification:function(a,b,c){a=this.prettyPrintJSON(a),c.find(".plastic-js-messages").append('<div class="plastic-js-msg plastic-js-msg-error"><strong>'+b.toUpperCase()+":</strong>"+a+"</div>")},dumpLogObject:function(){"use strict";console.log("> Dumping plastic.js log as Object:"),console.dir(this._logs)},dumpLogJSON:function(){"use strict";console.log("> Dumping plastic.js log as JSON String:"),console.log(JSON.stringify(this._logs,null,4))},prettyPrintJSON:function(a){return"string"!=typeof a&&(a=JSON.stringify(a,void 0,2)),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})}},plastic.helper.Events=function(){"use strict"},plastic.helper.Events.prototype={_subs:{},pub:function(a){var b=[].slice;if("string"!=typeof a)throw new Error("You must provide a valid topic to publish.");var c,d,e,f,g=b.call(arguments,1),h=0;if(!this._subs[a])return!0;for(c=this._subs[a].slice(),e=c.length;e>h&&(d=c[h],f=d.callback.apply(d.context,g),f!==!1);h++);return f!==!1},sub:function(a,b,c,d){if("string"!=typeof a)throw new Error("You must provide a valid topic to create a subscription.");3===arguments.length&&"number"==typeof c&&(d=c,c=b,b=null),2===arguments.length&&(c=b,b=null),d=d||10;for(var e,f=0,g=a.split(/\s/),h=g.length;h>f;f++){a=g[f],e=!1,this._subs[a]||(this._subs[a]=[]);for(var i=this._subs[a].length-1,j={callback:c,context:b,priority:d};i>=0;i--)if(this._subs[a][i].priority<=d){this._subs[a].splice(i+1,0,j),e=!0;break}e||this._subs[a].unshift(j)}return c},unsub:function(a,b,c){if("string"!=typeof a)throw new Error("You must provide a valid topic to remove a subscription.");if(2===arguments.length&&(c=b,b=null),this._subs[a])for(var d=this._subs[a].length,e=0;d>e;e++)this._subs[a][e].callback===c&&(b&&this._subs[a][e].context!==b||(this._subs[a].splice(e,1),e--,d--))}},plastic.helper.schemaValidation=function(a,b,c){"use strict";var d=jjv();d.addSchema("schema",a);var e=d.validate("schema",b);if(e)throw plastic.errors.push(e),new Error(c?c:"Object validation failed! Fore more informations look into the development console.")},LazyLoad=function(a){function b(b,c){var d,e=a.createElement(b);for(d in c)c.hasOwnProperty(d)&&e.setAttribute(d,c[d]);return e}function c(a){var b,c,d=j[a];d&&(b=d.callback,c=d.urls,c.shift(),k=0,c.length||(b&&b.call(d.context,d.obj),j[a]=null,l[a].length&&e(a)))}function d(){var b=navigator.userAgent;h={async:a.createElement("script").async===!0},(h.webkit=/AppleWebKit\//.test(b))||(h.ie=/MSIE|Trident/.test(b))||(h.opera=/Opera/.test(b))||(h.gecko=/Gecko\//.test(b))||(h.unknown=!0)}function e(e,k,m,n,o){var p,q,r,s,t,u,v=function(){c(e)},w="css"===e,x=[];if(h||d(),k)if(k="string"==typeof k?[k]:k.concat(),w||h.async||h.gecko||h.opera)l[e].push({urls:k,callback:m,obj:n,context:o});else for(p=0,q=k.length;q>p;++p)l[e].push({urls:[k[p]],callback:p===q-1?m:null,obj:n,context:o});if(!j[e]&&(s=j[e]=l[e].shift())){for(i||(i=a.head||a.getElementsByTagName("head")[0]),t=s.urls.concat(),p=0,q=t.length;q>p;++p)u=t[p],w?r=h.gecko?b("style"):b("link",{href:u,rel:"stylesheet"}):(r=b("script",{src:u}),r.async=!1),r.className="lazyload",r.setAttribute("charset","utf-8"),h.ie&&!w&&"onreadystatechange"in r&&!("draggable"in r)?r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=null,v())}:w&&(h.gecko||h.webkit)?h.webkit?(s.urls[p]=r.href,g()):(r.innerHTML='@import "'+u+'";',f(r)):r.onload=r.onerror=v,x.push(r);for(p=0,q=x.length;q>p;++p)i.appendChild(x[p])}}function f(a){var b;try{b=!!a.sheet.cssRules}catch(d){return k+=1,void(200>k?setTimeout(function(){f(a)},50):b&&c("css"))}c("css")}function g(){var a,b=j.css;if(b){for(a=m.length;--a>=0;)if(m[a].href===b.urls[0]){c("css");break}k+=1,b&&(200>k?setTimeout(g,50):c("css"))}}var h,i,j={},k=0,l={css:[],js:[]},m=a.styleSheets;return{css:function(a,b,c,d){e("css",a,b,c,d)},js:function(a,b,c,d){e("js",a,b,c,d)}}}(this.document),function(){function a(){return this instanceof a?(this.coerceType={},this.fieldType=b(f),this.fieldValidate=b(h),this.fieldFormat=b(g),this.defaultOptions=b(m),void(this.schema={})):new a}var b=function(a){if(null===a||"object"!=typeof a)return a;var c;if(a instanceof Date)return c=new Date,c.setTime(a.getTime()),c;if(a instanceof RegExp)return c=new RegExp(a);if(a instanceof Array){c=[];for(var d=0,e=a.length;e>d;d++)c[d]=b(a[d]);return c}if(a instanceof Object){c={};for(var f in a)a.hasOwnProperty(f)&&(c[f]=b(a[f]));return c}throw new Error("Unable to clone object!")},c=function(a){var c=a.length-1,d=a[c].key,e=a.slice(0);return e[c].object[d]=b(e[c].object[d]),e},d=function(a,b){var c=a.length-1,d=a[c].key;b[c].object[d]=a[c].object[d]},e={type:!0,not:!0,anyOf:!0,allOf:!0,oneOf:!0,$ref:!0,$schema:!0,id:!0,exclusiveMaximum:!0,exclusiveMininum:!0,properties:!0,patternProperties:!0,additionalProperties:!0,items:!0,additionalItems:!0,required:!0,"default":!0,title:!0,description:!0,definitions:!0,dependencies:!0},f={"null":function(a){return null===a},string:function(a){return"string"==typeof a},"boolean":function(a){return"boolean"==typeof a},number:function(a){return"number"==typeof a&&!isNaN(a)},integer:function(a){return"number"==typeof a&&a%1===0},object:function(a){return a&&"object"==typeof a&&!Array.isArray(a)},array:function(a){return Array.isArray(a)},date:function(a){return a instanceof Date}},g={alpha:function(a){return/^[a-zA-Z]+$/.test(a)},alphanumeric:function(a){return/^[a-zA-Z0-9]+$/.test(a)},identifier:function(a){return/^[-_a-zA-Z0-9]+$/.test(a)},hexadecimal:function(a){return/^[a-fA-F0-9]+$/.test(a)},numeric:function(a){return/^[0-9]+$/.test(a)},"date-time":function(a){return!isNaN(Date.parse(a))&&-1===a.indexOf("/")},uppercase:function(a){return a===a.toUpperCase()},lowercase:function(a){return a===a.toLowerCase()},hostname:function(a){return a.length<256&&/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/.test(a)},uri:function(a){return/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/.test(a)},email:function(a){return/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/.test(a)},ipv4:function(a){if(/^(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)\.(\d?\d?\d)$/.test(a)){var b=a.split(".").sort();if(b[3]<=255)return!0}return!1},ipv6:function(a){return/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/.test(a)}},h={readOnly:function(){return!1},minimum:function(a,b,c){return!(b>a||c.exclusiveMinimum&&b>=a)},maximum:function(a,b,c){return!(a>b||c.exclusiveMaximum&&a>=b)},multipleOf:function(a,b){return a/b%1===0||"number"!=typeof a},pattern:function(a,b){if("string"!=typeof a)return!0;var c,d;"string"==typeof b?c=b:(c=b[0],d=b[1]);var e=new RegExp(c,d);return e.test(a)},minLength:function(a,b){return a.length>=b||"string"!=typeof a},maxLength:function(a,b){return a.length<=b||"string"!=typeof a},minItems:function(a,b){return a.length>=b||!Array.isArray(a)},maxItems:function(a,b){return a.length<=b||!Array.isArray(a)},uniqueItems:function(a){for(var b,c={},d=0,e=a.length;e>d;d++){if(b=JSON.stringify(a[d]),c.hasOwnProperty(b))return!1;c[b]=!0}return!0},minProperties:function(a,b){if("object"!=typeof a)return!0;var c=0;for(var d in a)a.hasOwnProperty(d)&&(c+=1);return c>=b},maxProperties:function(a,b){if("object"!=typeof a)return!0;var c=0;for(var d in a)a.hasOwnProperty(d)&&(c+=1);return b>=c},"enum":function(a,b){var c,d,e;if("object"==typeof a){for(e=JSON.stringify(a),c=0,d=b.length;d>c;c++)if(e===JSON.stringify(b[c]))return!0}else for(c=0,d=b.length;d>c;c++)if(a===b[c])return!0;return!1}},i=function(a){return-1===a.indexOf("://")?a:a.split("#")[0]},j=function(a,b,c){var d,e,f,g;if(f=c.indexOf("#"),-1===f)return a.schema.hasOwnProperty(c)?[a.schema[c]]:null;if(f>0)if(g=c.substr(0,f),c=c.substr(f+1),a.schema.hasOwnProperty(g))b=[a.schema[g]];else{if(!b||b[0].id!==g)return null;b=[b[0]]}else{if(!b)return null;c=c.substr(1)}if(""===c)return[b[0]];if("/"===c.charAt(0)){for(c=c.substr(1),d=b[0],e=c.split("/");e.length>0;){if(!d.hasOwnProperty(e[0]))return null;d=d[e[0]],b.push(d),e.shift()}return b}return null},k=function(a,b){var c,d,e,f,g=a.length-1,h=/^(\d+)/.exec(b);if(h){if(b=b.substr(h[0].length),e=parseInt(h[1],10),0>e||e>g)return;if(f=a[g-e],"#"===b)return f.key}else f=a[0];if(d=f.object[f.key],""===b)return d;if("/"===b.charAt(0)){for(b=b.substr(1),c=b.split("/");c.length>0;){if(c[0]=c[0].replace(/~1/g,"/").replace(/~0/g,"~"),!d.hasOwnProperty(c[0]))return;d=d[c[0]],c.shift()}return d}},l=function(a,b,f,g){var h,i,m,n,o,p,q,r,s,t,u=!1,v={},w=b.length-1,x=b[w],y=f.length-1,z=f[y].object,A=f[y].key,B=z[A];if(x.hasOwnProperty("$ref"))return b=j(a,b,x.$ref),b?l(a,b,f,g):{$ref:x.$ref};if(x.hasOwnProperty("type"))if("string"==typeof x.type){if(g.useCoerce&&a.coerceType.hasOwnProperty(x.type)&&(B=z[A]=a.coerceType[x.type](B)),!a.fieldType[x.type](B))return{type:x.type}}else{for(u=!0,h=0,i=x.type.length;i>h&&u;h++)a.fieldType[x.type[h]](B)&&(u=!1);if(u)return{type:x.type}}if(x.hasOwnProperty("allOf"))for(h=0,i=x.allOf.length;i>h;h++)if(r=l(a,b.concat(x.allOf[h]),f,g))return r;if(g.useCoerce||g.useDefault||g.removeAdditional){if(x.hasOwnProperty("oneOf")){for(h=0,i=x.oneOf.length,m=0;i>h;h++)if(new_stack=c(f),r=l(a,b.concat(x.oneOf[h]),new_stack,g))v=r;else{if(m+=1,m>1)break;d(new_stack,f)}if(m>1)return{oneOf:!0};if(1>m)return v;v={}}if(x.hasOwnProperty("anyOf")){for(h=0,i=x.anyOf.length;i>h;h++)if(new_stack=c(f),r=l(a,b.concat(x.anyOf[h]),new_stack,g),!r){d(new_stack,f);break}if(r)return r}if(x.hasOwnProperty("not")&&(r=l(a,b.concat(x.not),c(f),g),!r))return{not:!0}}else{if(x.hasOwnProperty("oneOf")){for(h=0,i=x.oneOf.length,m=0;i>h;h++)if(r=l(a,b.concat(x.oneOf[h]),f,g))v=r;else if(m+=1,m>1)break;if(m>1)return{oneOf:!0};if(1>m)return v;v={}}if(x.hasOwnProperty("anyOf")){for(h=0,i=x.anyOf.length;i>h&&(r=l(a,b.concat(x.anyOf[h]),f,g),r);h++);if(r)return r}if(x.hasOwnProperty("not")&&(r=l(a,b.concat(x.not),f,g),!r))return{not:!0}}if(x.hasOwnProperty("dependencies"))for(p in x.dependencies)if(x.dependencies.hasOwnProperty(p)&&B.hasOwnProperty(p))if(Array.isArray(x.dependencies[p])){for(h=0,i=x.dependencies[p].length;i>h;h++)if(!B.hasOwnProperty(x.dependencies[p][h]))return{dependencies:!0}}else if(r=l(a,b.concat(x.dependencies[p]),f,g))return r;if(Array.isArray(B)){if(x.hasOwnProperty("items"))if(Array.isArray(x.items)){for(h=0,i=x.items.length;i>h;h++)r=l(a,b.concat(x.items[h]),f.concat({object:B,key:h}),g),null!==r&&(v[h]=r,u=!0);if(B.length>i&&x.hasOwnProperty("additionalItems"))if("boolean"==typeof x.additionalItems){if(!x.additionalItems)return{additionalItems:!0}}else for(h=i,i=B.length;i>h;h++)r=l(a,b.concat(x.additionalItems),f.concat({object:B,key:h}),g),null!==r&&(v[h]=r,u=!0)}else for(h=0,i=B.length;i>h;h++)r=l(a,b.concat(x.items),f.concat({object:B,key:h}),g),null!==r&&(v[h]=r,u=!0);else if(x.hasOwnProperty("additionalItems")&&"boolean"!=typeof x.additionalItems)for(h=0,i=B.length;i>h;h++)r=l(a,b.concat(x.additionalItems),f.concat({object:B,key:h}),g),null!==r&&(v[h]=r,u=!0);if(u)return{schema:v}}else{s=[],v={};for(p in B)B.hasOwnProperty(p)&&s.push(p);if(g.checkRequired&&x.required)for(h=0,i=x.required.length;i>h;h++)B.hasOwnProperty(x.required[h])||(v[x.required[h]]={required:!0},u=!0);if(n=x.hasOwnProperty("properties"),o=x.hasOwnProperty("patternProperties"),n||o)for(h=s.length;h--;){if(t=!1,n&&x.properties.hasOwnProperty(s[h])&&(t=!0,r=l(a,b.concat(x.properties[s[h]]),f.concat({object:B,key:s[h]}),g),null!==r&&(v[s[h]]=r,u=!0)),o)for(p in x.patternProperties)x.patternProperties.hasOwnProperty(p)&&s[h].match(p)&&(t=!0,r=l(a,b.concat(x.patternProperties[p]),f.concat({object:B,key:s[h]}),g),null!==r&&(v[s[h]]=r,u=!0));t&&s.splice(h,1)}if(g.useDefault&&n&&!u)for(p in x.properties)x.properties.hasOwnProperty(p)&&!B.hasOwnProperty(p)&&x.properties[p].hasOwnProperty("default")&&(B[p]=x.properties[p]["default"]);if(g.removeAdditional&&n&&x.additionalProperties!==!0&&"object"!=typeof x.additionalProperties)for(h=0,i=s.length;i>h;h++)delete B[s[h]];else if(x.hasOwnProperty("additionalProperties"))if("boolean"==typeof x.additionalProperties){if(!x.additionalProperties)for(h=0,i=s.length;i>h;h++)v[s[h]]={additional:!0},u=!0}else for(h=0,i=s.length;i>h;h++)r=l(a,b.concat(x.additionalProperties),f.concat({object:B,key:s[h]}),g),null!==r&&(v[s[h]]=r,u=!0);if(u)return{schema:v}}for(q in x)x.hasOwnProperty(q)&&!e.hasOwnProperty(q)&&("format"===q?a.fieldFormat.hasOwnProperty(x[q])&&!a.fieldFormat[x[q]](B,x,f,g)&&(v[q]=!0,u=!0):a.fieldValidate.hasOwnProperty(q)&&!a.fieldValidate[q](B,x[q].hasOwnProperty("$data")?k(f,x[q].$data):x[q],x,f,g)&&(v[q]=!0,u=!0));return u?v:null},m={useDefault:!1,useCoerce:!1,checkRequired:!0,removeAdditional:!1};a.prototype={validate:function(a,b,c){var d=[a],e=null,f=[{object:{__root__:b},key:"__root__"}];if("string"==typeof a&&(d=j(this,null,a),!d))throw new Error("jjv: could not find schema '"+a+"'.");if(c)for(var g in this.defaultOptions)this.defaultOptions.hasOwnProperty(g)&&!c.hasOwnProperty(g)&&(c[g]=this.defaultOptions[g]);else c=this.defaultOptions;return e=l(this,d,f,c),e?{validation:e.hasOwnProperty("schema")?e.schema:e}:null},resolveRef:function(a,b){return j(this,a,b)},addType:function(a,b){this.fieldType[a]=b},addTypeCoercion:function(a,b){this.coerceType[a]=b},addCheck:function(a,b){this.fieldValidate[a]=b},addFormat:function(a,b){this.fieldFormat[a]=b},addSchema:function(a,b){if(!b&&a&&(b=a,a=void 0),b.hasOwnProperty("id")&&"string"==typeof b.id&&b.id!==a){if("/"===b.id.charAt(0))throw new Error("jjv: schema id's starting with / are invalid.");this.schema[i(b.id)]=b}else if(!a)throw new Error("jjv: schema needs either a name or id attribute.");a&&(this.schema[i(a)]=b)}},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"function"==typeof define&&define.amd?define(function(){return a}):window.jjv=a}();