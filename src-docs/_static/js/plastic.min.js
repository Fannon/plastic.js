/*! plastic - v0.1.0 - 2014-11-14
* https://github.com/Fannon/plasticjs
* Copyright (c) 2014 Simon Heimler; Licensed MIT */
var plastic={};!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.tv4=b()}(this,function(){function a(b,c){if(b===c)return!0;if("object"==typeof b&&"object"==typeof c){if(Array.isArray(b)!==Array.isArray(c))return!1;if(Array.isArray(b)){if(b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(!a(b[d],c[d]))return!1}else{var e;for(e in b)if(void 0===c[e]&&void 0!==b[e])return!1;for(e in c)if(void 0===b[e]&&void 0!==c[e])return!1;for(e in b)if(!a(b[e],c[e]))return!1}return!0}return!1}function b(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function c(a,c){function d(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return c=b(c||""),a=b(a||""),c&&a?(c.protocol||a.protocol)+(c.protocol||c.authority?c.authority:a.authority)+d(c.protocol||c.authority||"/"===c.pathname.charAt(0)?c.pathname:c.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+c.pathname:a.pathname)+(c.protocol||c.authority||c.pathname?c.search:c.search||a.search)+c.hash:null}function d(a){return a.split("#")[0]}function e(a,b){if(a&&"object"==typeof a)if(void 0===b?b=a.id:"string"==typeof a.id&&(b=c(b,a.id),a.id=b),Array.isArray(a))for(var d=0;d<a.length;d++)e(a[d],b);else{"string"==typeof a.$ref&&(a.$ref=c(b,a.$ref));for(var f in a)"enum"!==f&&e(a[f],b)}}function f(a,b,c,d,e){if(Error.call(this),void 0===a)throw new Error("No code supplied for error: "+b);this.message=b,this.code=a,this.dataPath=c||"",this.schemaPath=d||"",this.subErrors=e||null;var f=new Error(this.message);if(this.stack=f.stack||f.stacktrace,!this.stack)try{throw f}catch(f){this.stack=f.stack||f.stacktrace}}function g(a,b){if(b.substring(0,a.length)===a){var c=b.substring(a.length);if(b.length>0&&"/"===b.charAt(a.length-1)||"#"===c.charAt(0)||"?"===c.charAt(0))return!0}return!1}function h(a){var b=new i,f=a||"en",g={addFormat:function(){b.addFormat.apply(b,arguments)},language:function(a){return a?(n[a]||(a=a.split("-")[0]),n[a]?(f=a,a):!1):f},addLanguage:function(a,b){var c;for(c in j)b[c]&&!b[j[c]]&&(b[j[c]]=b[c]);var d=a.split("-")[0];if(n[d]){n[a]=Object.create(n[d]);for(c in b)"undefined"==typeof n[d][c]&&(n[d][c]=b[c]),n[a][c]=b[c]}else n[a]=b,n[d]=b;return this},freshApi:function(a){var b=h();return a&&b.language(a),b},validate:function(a,c,d,e){var g=new i(b,!1,n[f],d,e);"string"==typeof c&&(c={$ref:c}),g.addSchema("",c);var h=g.validateAll(a,c,null,null,"");return!h&&e&&(h=g.banUnknownProperties()),this.error=h,this.missing=g.missing,this.valid=null===h,this.valid},validateResult:function(){var a={};return this.validate.apply(a,arguments),a},validateMultiple:function(a,c,d,e){var g=new i(b,!0,n[f],d,e);"string"==typeof c&&(c={$ref:c}),g.addSchema("",c),g.validateAll(a,c,null,null,""),e&&g.banUnknownProperties();var h={};return h.errors=g.errors,h.missing=g.missing,h.valid=0===h.errors.length,h},addSchema:function(){return b.addSchema.apply(b,arguments)},getSchema:function(){return b.getSchema.apply(b,arguments)},getSchemaMap:function(){return b.getSchemaMap.apply(b,arguments)},getSchemaUris:function(){return b.getSchemaUris.apply(b,arguments)},getMissingUris:function(){return b.getMissingUris.apply(b,arguments)},dropSchemas:function(){b.dropSchemas.apply(b,arguments)},defineKeyword:function(){b.defineKeyword.apply(b,arguments)},defineError:function(a,b,c){if("string"!=typeof a||!/^[A-Z]+(_[A-Z]+)*$/.test(a))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof b||b%1!==0||1e4>b)throw new Error("Code number must be an integer > 10000");if("undefined"!=typeof j[a])throw new Error("Error already defined: "+a+" as "+j[a]);if("undefined"!=typeof k[b])throw new Error("Error code already used: "+k[b]+" as "+b);j[a]=b,k[b]=a,m[a]=m[b]=c;for(var d in n){var e=n[d];e[a]&&(e[b]=e[b]||e[a])}},reset:function(){b.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:e,resolveUrl:c,getDocumentUri:d,errorCodes:j};return g}Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&1/0!==d&&d!==-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Object.isFrozen||(Object.isFrozen=function(a){for(var b="tv4_test_frozen_key";a.hasOwnProperty(b);)b+=Math.random();try{return a[b]=!0,delete a[b],!1}catch(c){return!0}});var i=function(a,b,c,d,e){if(this.missing=[],this.missingMap={},this.formatValidators=a?Object.create(a.formatValidators):{},this.schemas=a?Object.create(a.schemas):{},this.collectMultiple=b,this.errors=[],this.handleError=b?this.collectError:this.returnError,d&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),e&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorMessages=c,this.definedKeywords={},a)for(var f in a.definedKeywords)this.definedKeywords[f]=a.definedKeywords[f].slice(0)};i.prototype.defineKeyword=function(a,b){this.definedKeywords[a]=this.definedKeywords[a]||[],this.definedKeywords[a].push(b)},i.prototype.createError=function(a,b,c,d,e){var g=this.errorMessages[a]||m[a];if("string"!=typeof g)return new f(a,"Unknown error code "+a+": "+JSON.stringify(b),c,d,e);var h=g.replace(/\{([^{}]*)\}/g,function(a,c){var d=b[c];return"string"==typeof d||"number"==typeof d?d:a});return new f(a,h,c,d,e)},i.prototype.returnError=function(a){return a},i.prototype.collectError=function(a){return a&&this.errors.push(a),null},i.prototype.prefixErrors=function(a,b,c){for(var d=a;d<this.errors.length;d++)this.errors[d]=this.errors[d].prefixWith(b,c);return this},i.prototype.banUnknownProperties=function(){for(var a in this.unknownPropertyPaths){var b=this.createError(j.UNKNOWN_PROPERTY,{path:a},a,""),c=this.handleError(b);if(c)return c}return null},i.prototype.addFormat=function(a,b){if("object"==typeof a){for(var c in a)this.addFormat(c,a[c]);return this}this.formatValidators[a]=b},i.prototype.resolveRefs=function(a,b){if(void 0!==a.$ref){if(b=b||{},b[a.$ref])return this.createError(j.CIRCULAR_REFERENCE,{urls:Object.keys(b).join(", ")},"","");b[a.$ref]=!0,a=this.getSchema(a.$ref,b)}return a},i.prototype.getSchema=function(a,b){var c;if(void 0!==this.schemas[a])return c=this.schemas[a],this.resolveRefs(c,b);var d=a,e="";if(-1!==a.indexOf("#")&&(e=a.substring(a.indexOf("#")+1),d=a.substring(0,a.indexOf("#"))),"object"==typeof this.schemas[d]){c=this.schemas[d];var f=decodeURIComponent(e);if(""===f)return this.resolveRefs(c,b);if("/"!==f.charAt(0))return void 0;for(var g=f.split("/").slice(1),h=0;h<g.length;h++){var i=g[h].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===c[i]){c=void 0;break}c=c[i]}if(void 0!==c)return this.resolveRefs(c,b)}void 0===this.missing[d]&&(this.missing.push(d),this.missing[d]=d,this.missingMap[d]=d)},i.prototype.searchSchemas=function(a,b){if(a&&"object"==typeof a){"string"==typeof a.id&&g(b,a.id)&&void 0===this.schemas[a.id]&&(this.schemas[a.id]=a);for(var c in a)if("enum"!==c)if("object"==typeof a[c])this.searchSchemas(a[c],b);else if("$ref"===c){var e=d(a[c]);e&&void 0===this.schemas[e]&&void 0===this.missingMap[e]&&(this.missingMap[e]=e)}}},i.prototype.addSchema=function(a,b){if("string"!=typeof a||"undefined"==typeof b){if("object"!=typeof a||"string"!=typeof a.id)return;b=a,a=b.id}(a=d(a)+"#")&&(a=d(a)),this.schemas[a]=b,delete this.missingMap[a],e(b,a),this.searchSchemas(b,a)},i.prototype.getSchemaMap=function(){var a={};for(var b in this.schemas)a[b]=this.schemas[b];return a},i.prototype.getSchemaUris=function(a){var b=[];for(var c in this.schemas)(!a||a.test(c))&&b.push(c);return b},i.prototype.getMissingUris=function(a){var b=[];for(var c in this.missingMap)(!a||a.test(c))&&b.push(c);return b},i.prototype.dropSchemas=function(){this.schemas={},this.reset()},i.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},i.prototype.validateAll=function(a,b,c,d,e){var g;if(b=this.resolveRefs(b),!b)return null;if(b instanceof f)return this.errors.push(b),b;var h,i=this.errors.length,j=null,k=null;if(this.checkRecursive&&a&&"object"==typeof a){if(g=!this.scanned.length,a[this.validatedSchemasKey]){var l=a[this.validatedSchemasKey].indexOf(b);if(-1!==l)return this.errors=this.errors.concat(a[this.validationErrorsKey][l]),null}if(Object.isFrozen(a)&&(h=this.scannedFrozen.indexOf(a),-1!==h)){var m=this.scannedFrozenSchemas[h].indexOf(b);if(-1!==m)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[h][m]),null}if(this.scanned.push(a),Object.isFrozen(a))-1===h&&(h=this.scannedFrozen.length,this.scannedFrozen.push(a),this.scannedFrozenSchemas.push([])),j=this.scannedFrozenSchemas[h].length,this.scannedFrozenSchemas[h][j]=b,this.scannedFrozenValidationErrors[h][j]=[];else{if(!a[this.validatedSchemasKey])try{Object.defineProperty(a,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(a,this.validationErrorsKey,{value:[],configurable:!0})}catch(n){a[this.validatedSchemasKey]=[],a[this.validationErrorsKey]=[]}k=a[this.validatedSchemasKey].length,a[this.validatedSchemasKey][k]=b,a[this.validationErrorsKey][k]=[]}}var o=this.errors.length,p=this.validateBasic(a,b,e)||this.validateNumeric(a,b,e)||this.validateString(a,b,e)||this.validateArray(a,b,e)||this.validateObject(a,b,e)||this.validateCombinations(a,b,e)||this.validateFormat(a,b,e)||this.validateDefinedKeywords(a,b,e)||null;if(g){for(;this.scanned.length;){var q=this.scanned.pop();delete q[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(p||o!==this.errors.length)for(;c&&c.length||d&&d.length;){var r=c&&c.length?""+c.pop():null,s=d&&d.length?""+d.pop():null;p&&(p=p.prefixWith(r,s)),this.prefixErrors(o,r,s)}return null!==j?this.scannedFrozenValidationErrors[h][j]=this.errors.slice(i):null!==k&&(a[this.validationErrorsKey][k]=this.errors.slice(i)),this.handleError(p)},i.prototype.validateFormat=function(a,b){if("string"!=typeof b.format||!this.formatValidators[b.format])return null;var c=this.formatValidators[b.format].call(null,a,b);return"string"==typeof c||"number"==typeof c?this.createError(j.FORMAT_CUSTOM,{message:c}).prefixWith(null,"format"):c&&"object"==typeof c?this.createError(j.FORMAT_CUSTOM,{message:c.message||"?"},c.dataPath||null,c.schemaPath||"/format"):null},i.prototype.validateDefinedKeywords=function(a,b){for(var c in this.definedKeywords)for(var d=this.definedKeywords[c],e=0;e<d.length;e++){var f=d[e],g=f(a,b[c],b);if("string"==typeof g||"number"==typeof g)return this.createError(j.KEYWORD_CUSTOM,{key:c,message:g}).prefixWith(null,"format");if(g&&"object"==typeof g){var h=g.code||j.KEYWORD_CUSTOM;if("string"==typeof h){if(!j[h])throw new Error("Undefined error code (use defineError): "+h);h=j[h]}var i="object"==typeof g.message?g.message:{key:c,message:g.message||"?"},k=g.schemaPath||"/"+c.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(h,i,g.dataPath||null,k)}}return null},i.prototype.validateBasic=function(a,b,c){var d;return(d=this.validateType(a,b,c))?d.prefixWith(null,"type"):(d=this.validateEnum(a,b,c))?d.prefixWith(null,"type"):null},i.prototype.validateType=function(a,b){if(void 0===b.type)return null;var c=typeof a;null===a?c="null":Array.isArray(a)&&(c="array");var d=b.type;"object"!=typeof d&&(d=[d]);for(var e=0;e<d.length;e++){var f=d[e];if(f===c||"integer"===f&&"number"===c&&a%1===0)return null}return this.createError(j.INVALID_TYPE,{type:c,expected:d.join("/")})},i.prototype.validateEnum=function(b,c){if(void 0===c["enum"])return null;for(var d=0;d<c["enum"].length;d++){var e=c["enum"][d];if(a(b,e))return null}return this.createError(j.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(b):b})},i.prototype.validateNumeric=function(a,b,c){return this.validateMultipleOf(a,b,c)||this.validateMinMax(a,b,c)||null},i.prototype.validateMultipleOf=function(a,b){var c=b.multipleOf||b.divisibleBy;return void 0===c?null:"number"==typeof a&&a%c!==0?this.createError(j.NUMBER_MULTIPLE_OF,{value:a,multipleOf:c}):null},i.prototype.validateMinMax=function(a,b){if("number"!=typeof a)return null;if(void 0!==b.minimum){if(a<b.minimum)return this.createError(j.NUMBER_MINIMUM,{value:a,minimum:b.minimum}).prefixWith(null,"minimum");if(b.exclusiveMinimum&&a===b.minimum)return this.createError(j.NUMBER_MINIMUM_EXCLUSIVE,{value:a,minimum:b.minimum}).prefixWith(null,"exclusiveMinimum")}if(void 0!==b.maximum){if(a>b.maximum)return this.createError(j.NUMBER_MAXIMUM,{value:a,maximum:b.maximum}).prefixWith(null,"maximum");if(b.exclusiveMaximum&&a===b.maximum)return this.createError(j.NUMBER_MAXIMUM_EXCLUSIVE,{value:a,maximum:b.maximum}).prefixWith(null,"exclusiveMaximum")}return null},i.prototype.validateString=function(a,b,c){return this.validateStringLength(a,b,c)||this.validateStringPattern(a,b,c)||null},i.prototype.validateStringLength=function(a,b){return"string"!=typeof a?null:void 0!==b.minLength&&a.length<b.minLength?this.createError(j.STRING_LENGTH_SHORT,{length:a.length,minimum:b.minLength}).prefixWith(null,"minLength"):void 0!==b.maxLength&&a.length>b.maxLength?this.createError(j.STRING_LENGTH_LONG,{length:a.length,maximum:b.maxLength}).prefixWith(null,"maxLength"):null},i.prototype.validateStringPattern=function(a,b){if("string"!=typeof a||void 0===b.pattern)return null;var c=new RegExp(b.pattern);return c.test(a)?null:this.createError(j.STRING_PATTERN,{pattern:b.pattern}).prefixWith(null,"pattern")},i.prototype.validateArray=function(a,b,c){return Array.isArray(a)?this.validateArrayLength(a,b,c)||this.validateArrayUniqueItems(a,b,c)||this.validateArrayItems(a,b,c)||null:null},i.prototype.validateArrayLength=function(a,b){var c;return void 0!==b.minItems&&a.length<b.minItems&&(c=this.createError(j.ARRAY_LENGTH_SHORT,{length:a.length,minimum:b.minItems}).prefixWith(null,"minItems"),this.handleError(c))?c:void 0!==b.maxItems&&a.length>b.maxItems&&(c=this.createError(j.ARRAY_LENGTH_LONG,{length:a.length,maximum:b.maxItems}).prefixWith(null,"maxItems"),this.handleError(c))?c:null},i.prototype.validateArrayUniqueItems=function(b,c){if(c.uniqueItems)for(var d=0;d<b.length;d++)for(var e=d+1;e<b.length;e++)if(a(b[d],b[e])){var f=this.createError(j.ARRAY_UNIQUE,{match1:d,match2:e}).prefixWith(null,"uniqueItems");if(this.handleError(f))return f}return null},i.prototype.validateArrayItems=function(a,b,c){if(void 0===b.items)return null;var d,e;if(Array.isArray(b.items)){for(e=0;e<a.length;e++)if(e<b.items.length){if(d=this.validateAll(a[e],b.items[e],[e],["items",e],c+"/"+e))return d}else if(void 0!==b.additionalItems)if("boolean"==typeof b.additionalItems){if(!b.additionalItems&&(d=this.createError(j.ARRAY_ADDITIONAL_ITEMS,{}).prefixWith(""+e,"additionalItems"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalItems,[e],["additionalItems"],c+"/"+e))return d}else for(e=0;e<a.length;e++)if(d=this.validateAll(a[e],b.items,[e],["items"],c+"/"+e))return d;return null},i.prototype.validateObject=function(a,b,c){return"object"!=typeof a||null===a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,b,c)||this.validateObjectRequiredProperties(a,b,c)||this.validateObjectProperties(a,b,c)||this.validateObjectDependencies(a,b,c)||null},i.prototype.validateObjectMinMaxProperties=function(a,b){var c,d=Object.keys(a);return void 0!==b.minProperties&&d.length<b.minProperties&&(c=this.createError(j.OBJECT_PROPERTIES_MINIMUM,{propertyCount:d.length,minimum:b.minProperties}).prefixWith(null,"minProperties"),this.handleError(c))?c:void 0!==b.maxProperties&&d.length>b.maxProperties&&(c=this.createError(j.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:d.length,maximum:b.maxProperties}).prefixWith(null,"maxProperties"),this.handleError(c))?c:null},i.prototype.validateObjectRequiredProperties=function(a,b){if(void 0!==b.required)for(var c=0;c<b.required.length;c++){var d=b.required[c];if(void 0===a[d]){var e=this.createError(j.OBJECT_REQUIRED,{key:d}).prefixWith(null,""+c).prefixWith(null,"required");if(this.handleError(e))return e}}return null},i.prototype.validateObjectProperties=function(a,b,c){var d;for(var e in a){var f=c+"/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),g=!1;if(void 0!==b.properties&&void 0!==b.properties[e]&&(g=!0,d=this.validateAll(a[e],b.properties[e],[e],["properties",e],f)))return d;if(void 0!==b.patternProperties)for(var h in b.patternProperties){var i=new RegExp(h);if(i.test(e)&&(g=!0,d=this.validateAll(a[e],b.patternProperties[h],[e],["patternProperties",h],f)))return d}if(g)this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]);else if(void 0!==b.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]),"boolean"==typeof b.additionalProperties){if(!b.additionalProperties&&(d=this.createError(j.OBJECT_ADDITIONAL_PROPERTIES,{}).prefixWith(e,"additionalProperties"),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalProperties,[e],["additionalProperties"],f))return d}else this.trackUnknownProperties&&!this.knownPropertyPaths[f]&&(this.unknownPropertyPaths[f]=!0)}return null},i.prototype.validateObjectDependencies=function(a,b,c){var d;if(void 0!==b.dependencies)for(var e in b.dependencies)if(void 0!==a[e]){var f=b.dependencies[e];if("string"==typeof f){if(void 0===a[f]&&(d=this.createError(j.OBJECT_DEPENDENCY_KEY,{key:e,missing:f}).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];if(void 0===a[h]&&(d=this.createError(j.OBJECT_DEPENDENCY_KEY,{key:e,missing:h}).prefixWith(null,""+g).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(d=this.validateAll(a,f,[],["dependencies",e],c))return d}return null},i.prototype.validateCombinations=function(a,b,c){return this.validateAllOf(a,b,c)||this.validateAnyOf(a,b,c)||this.validateOneOf(a,b,c)||this.validateNot(a,b,c)||null},i.prototype.validateAllOf=function(a,b,c){if(void 0===b.allOf)return null;for(var d,e=0;e<b.allOf.length;e++){var f=b.allOf[e];if(d=this.validateAll(a,f,[],["allOf",e],c))return d}return null},i.prototype.validateAnyOf=function(a,b,c){if(void 0===b.anyOf)return null;var d,e,f=[],g=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var h=!0,i=0;i<b.anyOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var k=b.anyOf[i],l=this.errors.length,m=this.validateAll(a,k,[],["anyOf",i],c);if(null===m&&l===this.errors.length){if(this.errors=this.errors.slice(0,g),this.trackUnknownProperties){for(var n in this.knownPropertyPaths)e[n]=!0,delete d[n];for(var o in this.unknownPropertyPaths)e[o]||(d[o]=!0);h=!1;continue}return null}m&&f.push(m.prefixWith(null,""+i).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),h?(f=f.concat(this.errors.slice(g)),this.errors=this.errors.slice(0,g),this.createError(j.ANY_OF_MISSING,{},"","/anyOf",f)):void 0},i.prototype.validateOneOf=function(a,b,c){if(void 0===b.oneOf)return null;var d,e,f=null,g=[],h=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var i=0;i<b.oneOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var k=b.oneOf[i],l=this.errors.length,m=this.validateAll(a,k,[],["oneOf",i],c);if(null===m&&l===this.errors.length){if(null!==f)return this.errors=this.errors.slice(0,h),this.createError(j.ONE_OF_MULTIPLE,{index1:f,index2:i},"","/oneOf");if(f=i,this.trackUnknownProperties){for(var n in this.knownPropertyPaths)e[n]=!0,delete d[n];for(var o in this.unknownPropertyPaths)e[o]||(d[o]=!0)}}else m&&g.push(m.prefixWith(null,""+i).prefixWith(null,"oneOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===f?(g=g.concat(this.errors.slice(h)),this.errors=this.errors.slice(0,h),this.createError(j.ONE_OF_MISSING,{},"","/oneOf",g)):(this.errors=this.errors.slice(0,h),null)},i.prototype.validateNot=function(a,b,c){if(void 0===b.not)return null;var d,e,f=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var g=this.validateAll(a,b.not,null,null,c),h=this.errors.slice(f);return this.errors=this.errors.slice(0,f),this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===g&&0===h.length?this.createError(j.NOT_PASSED,{},"","/not"):null};var j={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},k={};for(var l in j)k[j[l]]=l;var m={INVALID_TYPE:"invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f.prototype.name="ValidationError",f.prototype.prefixWith=function(a,b){if(null!==a&&(a=a.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+a+this.dataPath),null!==b&&(b=b.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+b+this.schemaPath),null!==this.subErrors)for(var c=0;c<this.subErrors.length;c++)this.subErrors[c].prefixWith(a,b);return this};var n={},o=h();return o.addLanguage("en-gb",m),o.tv4=o,o}),LazyLoad=function(a){function b(b,c){var d,e=a.createElement(b);for(d in c)c.hasOwnProperty(d)&&e.setAttribute(d,c[d]);return e}function c(a){var b,c,d=j[a];d&&(b=d.callback,c=d.urls,c.shift(),k=0,c.length||(b&&b.call(d.context,d.obj),j[a]=null,l[a].length&&e(a)))}function d(){var b=navigator.userAgent;h={async:a.createElement("script").async===!0},(h.webkit=/AppleWebKit\//.test(b))||(h.ie=/MSIE|Trident/.test(b))||(h.opera=/Opera/.test(b))||(h.gecko=/Gecko\//.test(b))||(h.unknown=!0)}function e(e,k,m,n,o){var p,q,r,s,t,u,v=function(){c(e)},w="css"===e,x=[];if(h||d(),k)if(k="string"==typeof k?[k]:k.concat(),w||h.async||h.gecko||h.opera)l[e].push({urls:k,callback:m,obj:n,context:o});else for(p=0,q=k.length;q>p;++p)l[e].push({urls:[k[p]],callback:p===q-1?m:null,obj:n,context:o});if(!j[e]&&(s=j[e]=l[e].shift())){for(i||(i=a.head||a.getElementsByTagName("head")[0]),t=s.urls.concat(),p=0,q=t.length;q>p;++p)u=t[p],w?r=h.gecko?b("style"):b("link",{href:u,rel:"stylesheet"}):(r=b("script",{src:u}),r.async=!1),r.className="lazyload",r.setAttribute("charset","utf-8"),h.ie&&!w&&"onreadystatechange"in r&&!("draggable"in r)?r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=null,v())}:w&&(h.gecko||h.webkit)?h.webkit?(s.urls[p]=r.href,g()):(r.innerHTML='@import "'+u+'";',f(r)):r.onload=r.onerror=v,x.push(r);for(p=0,q=x.length;q>p;++p)i.appendChild(x[p])}}function f(a){var b;try{b=!!a.sheet.cssRules}catch(d){return k+=1,void(200>k?setTimeout(function(){f(a)},50):b&&c("css"))}c("css")}function g(){var a,b=j.css;if(b){for(a=m.length;--a>=0;)if(m[a].href===b.urls[0]){c("css");break}k+=1,b&&(200>k?setTimeout(g,50):c("css"))}}var h,i,j={},k=0,l={css:[],js:[]},m=a.styleSheets;return{css:function(a,b,c,d){e("css",a,b,c,d)},js:function(a,b,c,d){e("js",a,b,c,d)}}}(this.document),plastic.options={debug:!1,log:!0,benchmark:!1,width:"100%",height:"auto",timeout:12e3,showInfoBox:!1},plastic.version="0.2.0",plastic.elements=[],plastic.modules={query:{},api:{},data:{},display:{}},plastic.helper={},plastic.errors=[],plastic.execute=function(){"use strict";plastic.options.debug&&plastic.msg.log("[MAIN] plastic.js version v"+plastic.version+" INIT"),plastic.events=new plastic.helper.Events;var a=$("plastic, .plastic-js");a.each(function(){var a=$(this);if(plastic.options.debug)plastic.elements.push(new plastic.Element(a));else if(plastic.options.debug)try{plastic.elements.push(new plastic.Element(a))}catch(b){b.message+=" | plastic element crashed while init (creation)",plastic.msg.error(b,"error",a)}else plastic.elements.push(new plastic.Element(a))}),plastic.modules.dependencyManager.fetch(),$.each(plastic.elements,function(a,b){if(b.options.debug)b.execute();else try{b.execute()}catch(c){c.message+=" | plastic element crashed while init (execution)",plastic.msg.error(c,"error",b)}})},plastic.Element=function(a){this.createMessageContainer(a);var b=this;this.$el=a,this.id=void 0,a&&a[0]&&a[0].id?this.id=a[0].id:(this.id="plastic-el-"+plastic.elements.length+1,a[0].id=this.id),this.options=plastic.options,this.options.debug&&plastic.msg.log("[#"+this.id+"] new plastic.Element()"),this.events=new plastic.helper.Events,this.eventsTotal=1,this.eventsProgress=0,this.benchmarkStart=(new Date).getTime(),this.benchmarkDataLoaded=0,this.benchmarkModulesLoaded=[],this.benchmarkCompleted=0,this.dependencies=[],this.attr=new plastic.ElementAttributes(this),this.queryModule=!1,this.dataModule=!1,this.displayModule=!1,this.mergeOptions(),this.registerDependencies();for(var c=function(){"use strict";b.benchmarkModulesLoaded.push((new Date).getTime()),this.updateProgress()},d=0;d<this.dependencies.length;d++)this.eventsTotal+=1,plastic.events.sub("loaded-"+this.dependencies[d],b,c)},plastic.Element.prototype={execute:function(){var a=this;if(this.createDisplayContainer(this.$el),plastic.options.showInfoBox&&this.createInfoContainer(this.$el),this.attr.query&&(this.queryModule=new plastic.modules.Module(this,"query",this.attr.query.dataType)),this.attr.data&&this.attr.data.url){var b=["csv","tsv","text/comma-separated-values"],c="json",d=this.attr.data.dataFormat||this.attr.data.dataType;this.attr.data.url.indexOf("://")>-1&&(c="jsonp"),b.indexOf(d)>-1&&(c="text"),this.options.debug&&plastic.msg.log("[#"+this.id+"] Data-URL: "+this.attr.data.url);var e=$.ajax({url:this.attr.data.url,dataType:c,timeout:this.options.timeout});e.done(function(b){a.events.pub("data-sucess"),a.attr.data.raw="text"===c?String(b):null!==b&&"object"==typeof b?b:$.parseJSON(b)}),e.fail(function(b){a.cancelProgress(b),plastic.msg.error(b,a.$el)}),e.always(function(){a.updateProgress(),a.benchmarkDataLoaded=(new Date).getTime()})}else a.updateProgress()},updateAttributes:function(){"use strict";this.attributes=new plastic.ElementAttributes(this.$el)},createMessageContainer:function(a){"use strict";a.append('<div class="plastic-js-messages"></div>');var b=a.find(".plastic-js-messages");b.width(a.innerWidth())},createDisplayContainer:function(a){"use strict";a.append('<div class="plastic-js-output"></div>');var b=a.find(".plastic-js-output");b.height(a.height()>0?a.height():"auto"),b.html('<div class="loading"></div><div class="spinner"></div></div>')},createInfoContainer:function(a){"use strict";a.append('<div class="plastic-js-info"></div>'),a.css("margin-bottom","42px")},updateProgress:function(){"use strict";this.eventsProgress+=1,this.options.debug&&plastic.msg.log("[#"+this.id+"] Current Progress: "+this.eventsProgress+"/"+this.eventsTotal),this.eventsProgress===this.eventsTotal&&this.completeProgress()},cancelProgress:function(a){"use strict";plastic.msg.error("plastic.js processing aborted - "+a.message,this.$el),this.events=new plastic.helper.Events},completeProgress:function(){"use strict";var a=this.attr.data.dataFormat||this.attr.data.dataType;this.dataModule=new plastic.modules.Module(this,"data",a),this.attr.data.description||(this.attr.data.description=plastic.helper.duckTyping(this.attr.data.processed)),this.applySchema(),this.displayModule=new plastic.modules.Module(this,"display",this.attr.display.module),this.benchmarkCompleted=(new Date).getTime(),this.options.benchmark&&this.displayBenchmark(),this.options.showInfoBox&&this.displayInfoBox()},registerDependencies:function(){"use strict";var a=plastic.modules.moduleManager.get("display",this.attr.display.module);if(a?a.dependencies?plastic.modules.dependencyManager.add(a.dependencies):plastic.msg.warn("No Dependencies set!",this.$el):plastic.msg.error("Display Module not found!",this.$el),this.attr.data&&this.attr.data.module){var b=plastic.modules.moduleManager.get("data",this.attr.data.module);plastic.modules.dependencyManager.add(b.dependencies)}this.dependencies=this.dependencies.concat(a.dependencies)},mergeOptions:function(){"use strict";this.options=$.extend(!0,{},plastic.options,this.attr.options.options)
},displayBenchmark:function(){"use strict";var a=this.benchmarkDataLoaded-this.benchmarkStart,b=this.benchmarkCompleted-this.benchmarkStart,c="[#"+this.id+"] BENCHMARK:";c+=" DATA: "+a+"ms";for(var d=0;d<this.benchmarkModulesLoaded.length;d++){var e=this.benchmarkModulesLoaded[d],f=e-this.benchmarkStart;c+=" | DEPENDENCY "+(d+1)+": "+f+"ms"}c+=" | TOTAL: "+b+"ms",plastic.msg.log(c)},displayInfoBox:function(){"use strict";var a=this.$el.find(".plastic-js-info"),b="Data : "+(this.benchmarkDataLoaded-this.benchmarkStart)+"ms | ";b+="Total: "+(this.benchmarkCompleted-this.benchmarkStart)+"ms",a.html(b)},applySchema:function(){"use strict";var a=this,b=this.attr.data.processed,c=this.attr.data.description,d=function(){for(var d={email:function(a){var b=a.replace("mailto:","");return'<a href="'+a+'">'+b+"</a>"},phone:function(a){var b=a.replace("tel:","");return'<a href="'+a+'">'+b+"</a>"},uri:function(a){var b=a.replace(/\w*:\/{2}/g,"");return'<a href="'+a+'">'+b+"</a>"}},e=$.extend(!0,[],b),f=0;f<e.length;f++){var g=e[f];for(var h in g){var i=g[h];if(c[h]&&c[h].format)for(var j=c[h].format,k=0;k<i.length;k++)j&&d[j]&&(i[k]=d[j](i[k]))}}a.attr.data.processedHtml=e};c&&Object.keys(c).length>0&&d()}},plastic.ElementAttributes=function(a){this.pEl=a,this.$el=a.$el,this.style={},this.options={},this.query=!1,this.display={},this.data=!1,this.description={};try{this.parse(),this.validate()}catch(b){console.log("plastic.js accident"),console.error(b)}},plastic.ElementAttributes.prototype={attrObjSchema:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{options:{type:"object"},display:{type:"object",properties:{module:{type:"string"},options:{type:"object"}},required:["module","options"]},query:{type:["object","boolean"],properties:{text:{type:"string"},dataType:{type:["string","boolean"]},url:{type:"string"}},required:["dataType","text","url"]},data:{type:["object","boolean"],properties:{module:{type:["object","boolean"]},raw:{type:["object","array","string"]},processed:{type:"array",items:{type:"object",additionalProperties:{type:"array"}}},processedHtml:{type:"array"},url:{type:"string"},description:{type:"object"}},required:["module"]}},required:["style","options"]},getAttrObj:function(){"use strict";var a={style:this.style,options:this.options,display:this.display};return this.data&&(a.data=this.data),this.query&&(a.query=this.query),a},parse:function(){"use strict";this.style=this.getStyle(),this.$el.attr("type")||this.$el.attr("data-type")?this.parseJSONAPI():this.parseHTMLAPI(),this.pEl.options.debug&&plastic.msg.dir(this.getAttrObj())},parseHTMLAPI:function(){"use strict";this.query=this.getDataFromElement("plastic-query",!1,!0),this.data=this.getDataFromElement("plastic-data",!1,!1),this.description=this.getDataFromElement("plastic-description",!1,!1),this.options=this.getDataFromElement("plastic-options",!1,!1)||{},this.display=this.getDataFromElement("plastic-display",!0,!1)},parseJSONAPI:function(){"use strict";var a=this.$el.text(),b={};this.$el.text("");try{b=JSON.parse(a)}catch(c){console.error(c)}this.query=b.query,this.data=b.data,this.description.options=b.description,this.options.options=b.options||{},this.display.module=b.display.module,this.display.options=b.display,delete this.display.options.module},getStyle:function(){"use strict";return{height:this.$el.height(),width:this.$el.width()}},getDataFromElement:function(a,b,c){"use strict";var d={},e=this.$el.find("."+a)||!1;if(e[0]){if(d.module=e.attr("data-module")||!1,d.dataType=e.attr("type")||e.attr("data-type")||!1,d.dataFormat=e.attr("data-format")||!1,d.url=e.attr("data-url")||!1,d.text=e[0].text||e[0].innerHTML||!1,d.allAttr={},$(e[0].attributes).each(function(){d.allAttr[this.nodeName]=this.value}),!c)if(d.text&&""!==d.text)try{d.options=d.text.replace(/&quot;/g,'"'),d.options=$.parseJSON(d.options)}catch(f){throw console.dir(f),plastic.msg.error("Invalid JSON in the Options Object!",this.$el),new Error(f)}else d.options={};return d}if(b)throw plastic.msg.error("No Display Module set!",this.$el),new Error("No Display Module set!");return!1},validate:function(){"use strict";plastic.helper.schemaValidation(this.attrObjSchema,this.getAttrObj(),"Element Attributes: Data Structure invalid!")}},plastic.msg={_logs:[],log:function(a,b){"use strict";this.createLogEntry(a,"info",b||!1),b&&console.log("[#"+b.id+"] "+a),console.log(a)},dir:function(a){"use strict";this.createLogEntry(a,"dump"),console.dir(a)},warn:function(a,b){"use strict";this.createLogEntry(a,"warning",b||!1),console.warn(a)},error:function(a,b){var c=a;console.error(a),this.createLogEntry(a,"error",b),a instanceof Error&&(c=a.message),this.createNotification(c,"error",b)},createLogEntry:function(a,b,c){"use strict";if(plastic.options.log){var d={timestamp:(new Date).getTime(),type:b,msg:a};c&&(d.el=c),this._logs.push(d)}},createNotification:function(a,b,c){if(c.$el&&(c=c.$el),c&&c.find){var d=c.find(".plastic-js-messages");d.append('<div class="plastic-js-msg plastic-js-msg-error"><strong>'+b.toUpperCase()+":</strong> "+a+"</div>"),$(".plastic-js-messages").show()}},dumpLogObject:function(){"use strict";console.log("> Dumping plastic.js log as Object:"),console.dir(this._logs)},dumpLogJSON:function(){"use strict";console.log("> Dumping plastic.js log as JSON String:"),console.log(JSON.stringify(this._logs,null,4))},prettyPrintJSON:function(a){return"string"!=typeof a&&(a=JSON.stringify(a,!1,2)),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})}},plastic.helper.duckTyping=function(a){"use strict";var b={},c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;for(var d in a[0]){var e=a[0][d][0];$.isNumeric(e)?b[d]={type:"number"}:(b[d]={type:"string"},e.indexOf("http://")>-1?b[d].format="url":c.test(e)||e.indexOf("mailto:")>-1?b[d].format="email":e.indexOf("tel:")>-1&&(b[d].format="phone"))}return b},plastic.helper.Events=function(){"use strict"},plastic.helper.Events.prototype={_subs:{},pub:function(a){var b=[].slice;if("string"!=typeof a)throw new Error("You must provide a valid topic to publish.");var c,d,e,f,g=b.call(arguments,1),h=0;if(!this._subs[a])return!0;for(c=this._subs[a].slice(),e=c.length;e>h&&(d=c[h],f=d.callback.apply(d.context,g),f!==!1);h++);return f!==!1},sub:function(a,b,c,d){if("string"!=typeof a)throw new Error("You must provide a valid topic to create a subscription.");3===arguments.length&&"number"==typeof c&&(d=c,c=b,b=null),2===arguments.length&&(c=b,b=null),d=d||10;for(var e,f=0,g=a.split(/\s/),h=g.length;h>f;f++){a=g[f],e=!1,this._subs[a]||(this._subs[a]=[]);for(var i=this._subs[a].length-1,j={callback:c,context:b,priority:d};i>=0;i--)if(this._subs[a][i].priority<=d){this._subs[a].splice(i+1,0,j),e=!0;break}e||this._subs[a].unshift(j)}return c},unsub:function(a,b,c){if("string"!=typeof a)throw new Error("You must provide a valid topic to remove a subscription.");if(2===arguments.length&&(c=b,b=null),this._subs[a])for(var d=this._subs[a].length,e=0;d>e;e++)this._subs[a][e].callback===c&&(b&&this._subs[a][e].context!==b||(this._subs[a].splice(e,1),e--,d--))}},plastic.helper.schemaValidation=function(a,b,c){"use strict";var d=tv4.validate(b,a);if(d)return!1;c&&tv4.error.message&&(c+=" "+tv4.error.message,tv4.error.dataPath&&(c+=" @"+tv4.error.dataPath));var e=new Error("Validation Error");throw e.name="Validation Error",e.message=c||tv4.error.message,e.schemaValidation=tv4.error,e.stack=(new Error).stack,e},plastic.modules.Module=function(a,b,c){if(this.pEl=a,this.name=c,this.type=b,this.module=void 0,this.info=plastic.modules.moduleManager.get(b,c),!this.info)throw new Error('Module of type "'+b+'" and name "'+c+'" not found!');var d=plastic.modules[b][this.info.className];if(!d)throw new Error('Module of type "'+b+'" and name "'+c+'" not found!');if("display"===b){var e=$(a.$el.find(".plastic-js-output")[0]);e.html(""),this.module=new d(e,a.attr),this.execute()}else if("data"===b)this.module=new d(a.attr.data),this.execute();else{if("query"!==b)throw new Error("Invalid Module Type!");this.module=new d(a.attr.query),this.execute()}},plastic.modules.Module.prototype={execute:function(){"use strict";"display"===this.type?(this.validate(),this.module.execute()):"data"===this.type?(this.validate(),this.pEl.attr.data=this.module.execute()):"query"===this.type&&(this.validate(),this.pEl.attr.data=this.module.execute())},validate:function(){"use strict";var a=this;if(this.module.validate){var b=this.module.validate();if(b)throw plastic.msg.log(b,a.pEl.$el),console.dir(b),new Error("Module "+this.name+": Validation Error!")}try{if(this.module.rawDataSchema&&this.pEl.attr.data&&this.pEl.attr.data.raw&&plastic.helper.schemaValidation(this.module.rawDataSchema,this.pEl.attr.data.raw,"Raw Data invalid!"),this.module.processedDataSchema&&this.pEl.attr.data&&this.pEl.attr.data.processed&&plastic.helper.schemaValidation(this.module.processedDataSchema,this.pEl.attr.data.processed,"Processed Data invalid!"),this.module.displayOptionsSchema){try{plastic.helper.schemaValidation(this.module.displayOptionsSchema,this.pEl.attr.display.options,"Display Options invalid!")}catch(c){return plastic.msg.error(c,this.pEl),!1}for(var d in this.module.displayOptionsSchema.properties)this.module.displayOptionsSchema.properties[d]?this.pEl.attr.display.options.hasOwnProperty(d)||(this.pEl.attr.display.options[d]=this.module.displayOptionsSchema.properties[d].default):plastic.msg.warn("Option given that is not defined in the Option Schema")}}catch(c){plastic.msg.error(c,this.pEl)}},update:function(){"use strict";this.module.update&&this.module.update()}},plastic.modules.dependencyManager={registry:{d3:{title:"D3.js",website:"http://d3js.org/",version:"3.4.6",js:["//cdnjs.cloudflare.com/ajax/libs/d3/3.4.6/d3.min.js"],test:"d3"},c3:{title:"C3.js",website:"http://c3js.org/",version:"0.1.29",js:["//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.min.js"],test:"c3"},nvd3:{title:"NVD3",website:"http://nvd3.org/",version:"1.1.15-beta",js:["//cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.js"],css:["//cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.css"],test:"nv"},dataTable:{title:"DataTables",website:"http://www.datatables.net/",version:"1.10.0",js:["//cdn.datatables.net/1.10.0/js/jquery.dataTables.js"],css:["//cdn.datatables.net/1.10.0/css/jquery.dataTables.css"],test:"$(document).DataTable"}},usedDeps:{},setDependency:function(a,b,c){"use strict";this.registry[a]={},b&&b instanceof Array&&(this.registry.js=b),c&&c instanceof Array&&(this.registry.css=c)},getDependency:function(a){"use strict";return this.registry[a]},add:function(a){"use strict";if(a)for(var b=0;b<a.length;b++){var c=a[b];this.usedDeps[c]=this.registry[c]}},fetch:function(){"use strict";var a=function(){plastic.events.pub("loaded-"+c+".css")},b=function(){plastic.events.pub("loaded-"+c)};for(var c in this.usedDeps){var d=this.usedDeps[c];this.missingDependency(d.test)?(LazyLoad.css(d.css,a,c),LazyLoad.js(d.js,b,c)):(b(),plastic.options.debug&&plastic.msg.log("[GLOBAL] Dependency "+c+" not loaded, it already exists "))}},missingDependency:function(a){"use strict";if(!a)return!0;var b=a;return a.indexOf("$(document).")>-1?(b=a.replace("$(document).",""),$(document)[b]?!1:!0):a.indexOf("$.")>-1?(b=a.replace("$.",""),$[b]?!1:!0):window[a]?!1:!0}},plastic.modules.moduleManager={modules:{api:{},data:{},display:{},query:{}},parametersSchema:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{moduleType:{type:"string"},apiName:{type:["string","array"]},className:{type:"string"},dependencies:{type:"array"}},required:["moduleType","apiName","className"]},register:function(a){"use strict";plastic.helper.schemaValidation(this.parametersSchema,a);try{if($.isArray(a.apiName))for(var b=0;b<a.apiName.length;b++)this.modules[a.moduleType][a.apiName[b]]=a;else this.modules[a.moduleType][a.apiName]=a}catch(c){console.log(c),console.error("Wrong usage of Module Registry!")}},get:function(a,b){"use strict";return this.modules[a]&&this.modules[a][b]?this.modules[a][b]:!1}},plastic.modules.moduleManager.register({moduleType:"data",apiName:"ask-json",className:"AskJson",dependencies:[]}),plastic.modules.data.AskJson=function(a){this.dataObj=a,this.dataDescription={},this.rawDataSchema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{query:{type:"object",properties:{printrequests:{type:"array",properties:{label:{type:"string"},typeid:{type:"string"},mode:{type:"number"}},required:["label","typeid"]},results:{type:"object",additionalProperties:{type:"object",properties:{printouts:{type:"object"},fulltext:{type:"string"},fullurl:{type:"string"}},required:["printouts"]}}},required:["printrequests","results"]}},required:["query"]},this.schemaMap={_txt:{type:"string"},_ema:{type:"string",format:"email"},_tel:{type:"string",format:"phone"}}},plastic.modules.data.AskJson.prototype={validate:function(){"use strict";return!1},execute:function(){return this.parseSchema(),this.parseData(),this.dataObj},parseSchema:function(){"use strict";if(!this.dataObj.description){for(var a=this.dataObj.raw.query.printrequests,b=0;b<a.length;b++){var c=a[b],d=this.schemaMap[c.typeid];d&&(this.dataDescription[c.label]=d)}this.dataObj.description=this.dataDescription}},parseData:function(){"use strict";this.dataObj.processed=[];for(var a in this.dataObj.raw.query.results){var b=this.dataObj.raw.query.results[a];this.dataObj.processed.push(b.printouts)}}},plastic.modules.moduleManager.register({moduleType:"data",apiName:["csv","tsv","text/comma-separated-values"],className:"CSV",dependencies:[]}),plastic.modules.data.CSV=function(a){this.dataObj=a,this.rawDataSchema={}},plastic.modules.data.CSV.prototype={validate:function(){"use strict";return!1},execute:function(){var a=";";return"tsv"===this.dataObj.module&&(a="	"),this.dataObj.processed=this.parseCSV(this.dataObj.raw,a,!1),this.dataObj},parseCSV:function(a,b,c){for(var d=[],e=[],f=a.split(c||"\r\n"),g=0;g<f.length;g++){var h=f[g];if(0===g)e=h.split(b||";");else if(h.length>0){d[g]={};for(var i=h.split(b||";"),j=0;j<i.length;j++){var k=i[j];d[g][e[j]]=k}}}return d}},plastic.modules.moduleManager.register({moduleType:"data",apiName:"default",className:"Default",dependencies:[]}),plastic.modules.data.Default=function(a){this.dataObj=a,this.dataDescription={},this.rawDataSchema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{data:{type:"array",items:{type:"object",additionalProperties:{type:"array"}}},schema:{type:"object",additionalProperties:{type:"object"}},description:{type:"object"}},required:["data"]},this.example={data:[{column1:["cell1"],column2:["cell2"]}],schema:{},description:{}}},plastic.modules.data.Default.prototype={validate:function(){"use strict";return!1},execute:function(){return this.dataObj.processed=this.dataObj.raw.data,this.dataObj}},plastic.modules.moduleManager.register({moduleType:"data",apiName:"simple-default",className:"SimpleDefault",dependencies:[]}),plastic.modules.data.SimpleDefault=function(a){this.dataObj=a,this.rawDataSchema={$schema:"http://json-schema.org/draft-04/schema#",type:"array",items:{type:"object"}}},plastic.modules.data.SimpleDefault.prototype={validate:function(){"use strict";return!1},execute:function(){for(var a=[],b=0;b<this.dataObj.raw.length;b++){var c=this.dataObj.raw[b];a[b]={};for(var d in c)a[b][d]=[c[d]]}return this.dataObj.processed=a,this.dataObj}},plastic.modules.moduleManager.register({moduleType:"data",apiName:"sparql-json",className:"SparqlJson",dependencies:[]}),plastic.modules.data.SparqlJson=function(a){this.dataObj=a,this.rawDataSchema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{head:{type:"object",properties:{link:{type:"array"},vars:{type:"array"}},required:["vars"]},results:{type:"object",properties:{bindings:{type:"array",additionalProperties:{type:"object",additionalProperties:{type:"object",properties:{datatype:{type:"string"},type:{type:"string"},value:{type:"string"}},required:["datatype","type","value"]}}},required:["bindings"]}}},required:["head","results"]},this.schemaDatatypeMap={"http://www.w3.org/2001/XMLSchema#integer":{type:"number"},"http://www.w3.org/2001/XMLSchema#double":{type:"number"},"http://www.w3.org/2001/XMLSchema#date":{type:"string",format:"date"}},this.schemaTypeMap={uri:{type:"string",format:"uri"},literal:{type:"string"}},this.dataDescription={}},plastic.modules.data.SparqlJson.prototype={validate:function(){"use strict";return!1},execute:function(){return this.parseSchema(),this.parseData(),this.dataObj},parseSchema:function(){"use strict";if(!this.dataObj.description){var a=this.dataObj.raw.results.bindings[0];for(var b in a){var c=a[b],d=!1;c.datatype?d=this.schemaDatatypeMap[c.datatype]:c.type&&(d=this.schemaTypeMap[c.type]),d||(d={type:"string"}),this.dataDescription[b]=d,this.dataObj.description=this.dataDescription}}},parseData:function(){"use strict";this.dataObj.processed=[];for(var a=0;a<this.dataObj.raw.results.bindings.length;a++){this.dataObj.processed[a]={};var b=this.dataObj.raw.results.bindings[a];for(var c in b){var d=b[c].value;"number"===this.dataDescription[c].type&&(d=parseFloat(d)),this.dataObj.processed[a][c]=[d]}}return this.dataObj}},plastic.modules.moduleManager.register({moduleType:"display",apiName:"advanced-table",className:"AdvancedTable",dependencies:["dataTable"]}),plastic.modules.display.AdvancedTable=function(a,b){"use strict";this.$el=a,this.elAttr=b,this.displayOptionsSchema={$schema:"http://json-schema.org/draft-04/schema#",title:"Advanced Table",type:"object",properties:{tableClasses:{title:"Table Classes",description:"Table CSS Classes",type:"string","default":""},paging:{title:"Paging",description:"Enable Pagination of Table Elements",type:"boolean","default":!1},lengthMenu:{title:"Menu Length",description:"Sets the available number of entries in the dropdown menu. Takes an 2dim array.",type:"array","default":[[10,25,50,100,-1],[10,25,50,100,"All"]]},searching:{title:"Searching",description:"Enable Searching of Table Elements",type:"boolean","default":!0},ordering:{title:"Ordering",description:"Feature control ordering (sorting) abilities in DataTables.",type:"boolean","default":!0},orderMulti:{title:"Multiple Ordering",description:"Multiple column ordering ability control.",type:"boolean","default":!0}},additionalProperties:!1,required:[]},this.processedDataSchema={}},plastic.modules.display.AdvancedTable.prototype={validate:function(){"use strict";return!1},execute:function(){var a=[],b=this.elAttr.display.options;a=this.elAttr.data.processedHtml?this.elAttr.data.processedHtml:this.elAttr.data.processed;var c=$('<table class="'+b.tableClasses+'" />'),d=$("<thead />"),e=$("<tr/>");for(var f in a[0])a[0].hasOwnProperty(f)&&e.append("<th>"+f+"</th>");d.append(e),c.append(d);var g=$("<tbody />");$.each(a,function(a,b){var c=$("<tr/>");for(var d in b)$("<td/>").html(b[d]).appendTo(c);g.append(c)}),c.append(g),this.$el.append(c),c.DataTable(b)},update:function(){"use strict";this.execute()}},plastic.modules.moduleManager.register({moduleType:"display",apiName:"line-chart",className:"CumulativeLineChart",dependencies:["d3","nvd3"]}),plastic.modules.display.CumulativeLineChart=function(a,b){"use strict";this.$el=a,this.elAttr=b,this.displayOptionsSchema={$schema:"http://json-schema.org/draft-04/schema#",title:"Cumulative Line Chart",type:"object",properties:{useInteractiveGuideline:{title:"Interactive Guideline",description:"Show the interactive Guideline.",type:"boolean","default":!0},transitionDuration:{title:"Transition Duration",description:"Duration of the animation in milliseconds.",type:"number",minimum:0,"default":350},showLegend:{title:"Display Legend",description:"Show the legend, allowing users to turn on/off line series.",type:"boolean","default":!0},marginLeft:{title:"Left Margin",description:"Adjust chart margins to give the x-axis some breathing room.",type:"boolean","default":!0}},additionalProperties:!1,required:[]},this.processedDataSchema={}},plastic.modules.display.CumulativeLineChart.prototype={validate:function(){"use strict";return!1},execute:function(){var a=this.elAttr.display.options,b=this.elAttr.data.processed,c=this.mapData(b),d=(this.$el.append("<svg></svg>"),nv.models.lineChart().margin({left:a.margin}).useInteractiveGuideline(a.useInteractiveGuideline).transitionDuration(a.transitionDuration).showLegend(a.showLegend).showYAxis(!0).showXAxis(!0));d3.select(this.$el[0].children[0]).datum(c).call(d),nv.utils.windowResize(function(){d.update()})},mapData:function(a){"use strict";var b=[],c=this.elAttr.data.description,d=this.findX(c);for(var e in c){var f=c[e];if(e!==d&&"number"===f.type){var g={};g.key=e,g.values=[];for(var h=0;h<a.length;h++){var i=a[h],j={x:h,y:i[e][0]};g.values.push(j)}b.push(g)}}return b},findX:function(a){"use strict";for(var b in a){var c=a[b];if("string"===c.type||c.format&&"date"===c.format)return b}for(b in a)return b},update:function(){"use strict";this.execute()}},plastic.modules.moduleManager.register({moduleType:"display",apiName:"discrete-bar-chart",className:"DiscreteBarChart",dependencies:["d3","nvd3"],requirements:["data-description"]}),plastic.modules.display.DiscreteBarChart=function(a,b){"use strict";this.$el=a,this.elAttr=b,this.displayOptionsSchema={$schema:"http://json-schema.org/draft-04/schema#",title:"Discrete Bar Chart",type:"object",properties:{staggerLabels:{title:"Label Staggering",description:"Too many bars and not enough room? Try staggering labels.",type:"boolean","default":!1},tooltips:{title:"Tooltips",description:"Show tooltips",type:"boolean","default":!0},showValues:{title:"Display Values",description:"Show the bar value right on top of each bar.",type:"boolean","default":!0},transitionDuration:{title:"Transition Duration",description:"Duration of the animation in milliseconds.",type:"number",minimum:0,"default":350}},additionalProperties:!1,required:[]},this.processedDataSchema={}},plastic.modules.display.DiscreteBarChart.prototype={validate:function(){"use strict";return!1},execute:function(){var a=this.elAttr.data.processed,b=(this.$el.append("<svg></svg>"),this.elAttr.display.options),c=nv.models.discreteBarChart().x(function(a){return a.label}).y(function(a){return a.value}).staggerLabels(b.staggerLabels).tooltips(b.tooltips).showValues(b.showValues),d=this.mapData(a);return d3.select(this.$el[0].children[0]).datum(d).transition().duration(b.transitionDuration).call(c),nv.utils.windowResize(c.update),c},mapData:function(a){"use strict";var b=[{}];b[0].key="",b[0].values=[];var c="",d="";if(this.elAttr.data.description){var e=this.elAttr.data.description;for(var f in e)""===c&&"string"===e[f].type&&(c=f),""===d&&"number"===e[f].type&&(d=f)}if(""===c||""===d)throw new Error("Could not map data to label and value! Please provide a correct data description / schema!");for(var g=0;g<a.length;g++){var h=a[g];b[0].values.push({label:h[c][0],value:parseInt(h[d][0],10)})}return b},update:function(){"use strict";this.execute()}},plastic.modules.moduleManager.register({moduleType:"display",apiName:"pie-chart",className:"PieChart",dependencies:["d3","nvd3"]}),plastic.modules.display.PieChart=function(a,b){"use strict";this.$el=a,this.elAttr=b,this.displayOptionsSchema={$schema:"http://json-schema.org/draft-04/schema#",title:"Pie Chart",type:"object",properties:{showLabels:{title:"Display Labels",description:"Show the labels.",type:"boolean","default":!0},tooltips:{title:"Tooltips",description:"Show tooltips",type:"boolean","default":!0},transitionDuration:{title:"Transition Duration",description:"Duration of the animation in milliseconds.",type:"number",minimum:0,"default":350}},additionalProperties:!1,required:[]},this.processedDataSchema={}},plastic.modules.display.PieChart.prototype={validate:function(){"use strict";return!1},execute:function(){var a=this.elAttr.data.processed,b=(this.$el.append("<svg></svg>"),this.elAttr.display.options),c=nv.models.pieChart().x(function(a){return a.label}).y(function(a){return a.value}).showLabels(b.showLabels).tooltips(b.tooltips),d=this.mapData(a);return d3.select(this.$el[0].children[0]).datum(d).transition().duration(b.transitionDuration).call(c),nv.utils.windowResize(c.update),c},mapData:function(a){"use strict";var b=[],c="",d="";if(this.elAttr.data.description){var e=this.elAttr.data.description;for(var f in e)""===c&&"string"===e[f].type&&(c=f),""===d&&"number"===e[f].type&&(d=f)}if(""===c||""===d)throw new Error("Could not map data to label and value! Please provide a correct data description / schema!");for(var g=0;g<a.length;g++){var h=a[g];b.push({label:h[c][0],value:parseInt(h[d][0])})}return b},update:function(){"use strict";this.execute()}},plastic.modules.moduleManager.register({moduleType:"display",apiName:"raw-data",className:"RawData",dependencies:[]}),plastic.modules.display.RawData=function(a,b){"use strict";this.$el=a,this.elAttr=b},plastic.modules.display.RawData.prototype={execute:function(){console.info(this.$el);var a='<pre class="raw-data">'+JSON.stringify(this.elAttr.data.raw,!1,4)+"</code></pre>";this.$el.html(a)},update:function(){"use strict";this.execute()}},plastic.modules.moduleManager.register({moduleType:"display",apiName:"simple-table",className:"SimpleTable",dependencies:[]}),plastic.modules.display.SimpleTable=function(a,b){"use strict";this.$el=a,this.elAttr=b,this.displayOptionsSchema={$schema:"http://json-schema.org/draft-04/schema#",title:"Simple Table",type:"object",properties:{tableClasses:{title:"Table Classes",description:"Table CSS Classes",type:"string","default":""}},additionalProperties:!1,required:[]},this.processedDataSchema={}},plastic.modules.display.SimpleTable.prototype={validate:function(){"use strict";return!1},execute:function(){var a=[],b=this.elAttr.display.options;a=this.elAttr.data.processedHtml?this.elAttr.data.processedHtml:this.elAttr.data.processed;var c=$('<table class="'+b.tableClasses+'" />'),d=$("<thead />"),e=$("<tr/>");for(var f in a[0])a[0].hasOwnProperty(f)&&e.append("<th>"+f+"</th>");d.append(e),c.append(d);var g=$("<tbody />");$.each(a,function(a,b){var c=$("<tr/>");for(var d in b)$("<td/>").html(b[d]).appendTo(c);g.append(c)}),c.append(g),this.$el.append(c)},update:function(){"use strict";this.execute()}},plastic.modules.moduleManager.register({moduleType:"query",apiName:"application/ask-query",className:"Ask",dependencies:[]}),plastic.modules.query.Ask=function(a){this.queryObj=a},plastic.modules.query.Ask.prototype={setQueryObj:function(a){"use strict";this.queryObj=a},validate:function(){"use strict";return!1},execute:function(){var a={dataFormat:"ask-json"},b=this.queryObj.url,c=this.queryObj.text,d=$.trim(c.replace(/\s+/g,"")),e=encodeURIComponent(d);return a.url=b+"?action=ask&query="+e+"&format=json&callback=?",a}},plastic.modules.moduleManager.register({moduleType:"query",apiName:"application/sparql-query",className:"Sparql",dependencies:[]}),plastic.modules.query.Sparql=function(a){this.queryObj=a},plastic.modules.query.Sparql.prototype={setQueryObj:function(a){"use strict";this.queryObj=a},validate:function(){"use strict";return!1},execute:function(){var a={dataFormat:"sparql-json"},b=this.queryObj.url,c=this.queryObj.text,d=$.trim(c.replace(/\s+/g," ")),e=encodeURIComponent(d);return a.url=b+"?query="+e+"&output=json&callback=?",a}},$(document).ready(function(){plastic.execute()});